# Генерация кода из Proto-файлов

## 1. Философия: Proto как SSOT

**Protocol Buffers (Proto)** являются **единственным источником правды (SSOT)** для определения структур данных, используемых в межпроцессном взаимодействии (IPC) и для сериализации сложных объектов (например, форматов расширений Chrome).

- **Никогда не редактируйте сгенерированный код вручную.** Все изменения должны вноситься только в `.proto` файлы.
- **Один Proto — один домен.** Определения, относящиеся к разным доменам (например, AI-агенты и расширения Chrome), должны находиться в разных `.proto` файлах.

## 2. Централизованное хранилище

Все `.proto` файлы находятся в централизованном пакете `packages/proto`. Это обеспечивает их легкое обнаружение и переиспользование в разных частях монорепозитория.

## 3. Процесс унификации и рефакторинга

Исторически в проекте существовала проблема дублирования proto-определений. Например, формат `CRX3` был определен в нескольких местах.

**Проблема:**

- Дублирование определений в разных пакетах.
- Ручное редактирование сгенерированных `.ts` файлов.
- Отсутствие единого скрипта для генерации кода.

**Решение:**

1. **Консолидация:** Все определения были объединены в канонические `.proto` файлы в `packages/proto`.
2. **Автоматическая генерация:** Был внедрен механизм для автоматической генерации TypeScript-кода из `.proto` файлов.
3. **Миграция:** Код, использовавший старые, сгенерированные вручную типы, был переключен на новые, автоматически сгенерированные.

**Результат:**

- **Поддерживаемость:** Изменение структуры данных теперь требует правки только одного `.proto` файла.
- **Надежность:** Автоматическая генерация устраняет человеческий фактор и возможные ошибки.
- **Расширяемость:** Добавление новых типов сообщений стало простым и предсказуемым процессом.

## 4. Как сгенерировать код

Для генерации TypeScript-кода из `.proto` файлов используйте соответствующие скрипты в `package.json`.

```bash
# Пример команды (может отличаться)
yarn generate:proto
```

Убедитесь, что у вас установлены все необходимые зависимости, включая `protoc` и соответствующие плагины.
