# Planner Service (Планировщик задач)

## 1. Назначение

**Planner Service** — это компонент AI-движка (`@neira/polylith-backend`), который отвечает за анализ запроса пользователя и преобразование его в структурированный план выполнения. План состоит из последовательности шагов (действий), которые затем выполняются другими компонентами системы.

## 2. Эволюция: от ключевых слов к LLM

### 2.1. Ранний подход: Keyword-based Planner

Изначально планировщик использовал примитивный подход, основанный на поиске **ключевых слов** в запросе пользователя.

**Проблема:**

- **Низкая гибкость:** Система могла реагировать только на строго определенные команды.
- **Отсутствие контекста:** Планировщик не понимал сложных, многосоставных запросов.
- **Трудоемкость:** Добавление новой команды требовало изменения кода и жесткой привязки к конкретным словам.

### 2.2. Текущий подход: LLM-based Planner

Чтобы преодолеть ограничения старого подхода, планировщик был полностью переработан. Теперь в его основе лежит **вызов большой языковой модели (LLM)**.

**Как это работает:**

1. **Системный промпт:** В LLM передается системный промпт, который содержит описание всех доступных системе инструментов (API, функций) в формате, понятном для модели.
2. **Анализ запроса:** LLM анализирует запрос пользователя в контексте доступных инструментов.
3. **Генерация плана:** Модель генерирует структурированный ответ (обычно в формате JSON), который представляет собой план — последовательность вызовов инструментов с необходимыми параметрами.

**Результат:**

- **Высокая гибкость:** Система способна понимать естественный язык и сложные, многоступенчатые запросы.
- **Масштабируемость:** Для добавления нового инструмента достаточно описать его в системном промпте, не изменяя код самого планировщика.
- **Качество планов:** LLM может строить более сложные и релевантные планы, чем система, основанная на ключевых словах.

## 3. Пример

**Запрос пользователя:** "Найди в интернете информацию о погоде в Москве и сохрани ее в файл."

**Сгенерированный план (упрощенно):**

```json
{
  "steps": [
    {
      "tool": "webSearch",
      "parameters": {
        "query": "погода в Москве"
      }
    },
    {
      "tool": "fileSystem.writeFile",
      "parameters": {
        "path": "./moscow-weather.txt",
        "content": "{{step1.result}}"
      }
    }
  ]
}
```
