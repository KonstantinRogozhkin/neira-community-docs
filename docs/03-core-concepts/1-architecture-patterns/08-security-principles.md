# üîê –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ NEIRA Super App

–í–µ—Ä—Å–∏—è: 1.1
–°—Ç–∞—Ç—É—Å: ‚úÖ **–î–µ–π—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç**

## ‚ö° –§–∏–ª–æ—Å–æ—Ñ–∏—è

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ NEIRA Super App ‚Äî —ç—Ç–æ –Ω–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–ª–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –ú—ã –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ–º—Å—è –ø—Ä–∏–Ω—Ü–∏–ø–∞ "–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" (Security by Default) –∏ "–Ω—É–ª–µ–≤–æ–≥–æ –¥–æ–≤–µ—Ä–∏—è" (Zero Trust), –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Ç–æ—á–∫–∞—Ö —Å–æ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è `shell` —Å –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º –∏ UI.

–°–≤—è–∑—å: [–°–∏—Å—Ç–µ–º–Ω—ã–π –æ–±–∑–æ—Ä](/03-core-concepts/1-architecture-patterns/01-system-overview), [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ IPC](/03-core-concepts/2-shell-core/06-ipc-architecture).

## üõ°Ô∏è –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã

### 1. –ü–µ—Å–æ—á–Ω–∏—Ü–∞ (Sandbox)

- **–ü—Ä–∞–≤–∏–ª–æ:** –í—Å–µ `BrowserWindow` –∏ `WebContentsView` **–¥–æ–ª–∂–Ω—ã** —Ä–∞–±–æ—Ç–∞—Ç—å —Å `sandbox: true`.
- **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ `neira://vscode` (–¥–ª—è Code-OSS) –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sandbox: false` –¥–ª—è —Ä–∞–±–æ—Ç—ã DevTools –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π. –≠—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ.
- **–¶–µ–ª—å:** –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å Renderer-–ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Node.js API, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏.

### 2. Content Security Policy (CSP)

NEIRA Super App –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É CSP: Electron-shell (main), preload-—Å–∫—Ä–∏–ø—Ç –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π UI (`neira-app`). CSP –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ **–∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ**.

#### –ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ CSP

1. **–ù–∏–∫–∞–∫–∏—Ö `unsafe-*` –¥–∏—Ä–µ–∫—Ç–∏–≤:** –î–∏—Ä–µ–∫—Ç–∏–≤—ã `unsafe-eval` –∏ `unsafe-inline` **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–µ—â–µ–Ω—ã** –¥–ª—è `script-src`. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: –≤—Ä–µ–º–µ–Ω–Ω–æ `unsafe-inline` –≤ `style-src` (Next.js –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ).

2. **`nonce` –¥–ª—è inline-–∫–æ–Ω—Ç–µ–Ω—Ç–∞:** –í—Å–µ inline-—Å–∫—Ä–∏–ø—Ç—ã (`<script>`) –∏ —Å—Ç–∏–ª–∏ (`<style>`) **–æ–±—è–∑–∞–Ω—ã** –∏–º–µ—Ç—å –∞—Ç—Ä–∏–±—É—Ç `nonce="{cspNonce}"`. `cspNonce` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `app/layout.tsx`.

3. **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞:** –õ—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Å–æ–±–µ–Ω–Ω–æ Markdown) **–¥–æ–ª–∂–µ–Ω** –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ç–æ—Ä (`rehype-sanitize`).

#### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ unsafe-eval: –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç framer-motion (CSP:UNSAFE_EVAL_REMOVAL)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `framer-motion` —Ç—Ä–µ–±–æ–≤–∞–ª–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤—É `'unsafe-eval'` –≤ CSP, —Å–æ–∑–¥–∞–≤–∞—è —Å–µ—Ä—å–µ–∑–Ω—É—é —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—É—é –¥–ª—è Electron-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.

**–†–µ—à–µ–Ω–∏–µ ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç framer-motion:**

1. ‚úÖ **–£–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** `framer-motion` –∏–∑ `packages/neira-app/package.json`
2. ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** –ó–∞–º–µ–Ω–µ–Ω—ã `motion.div` –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTML-—ç–ª–µ–º–µ–Ω—Ç—ã —Å CSS-–∞–Ω–∏–º–∞—Ü–∏—è–º–∏:
   - `SuggestedPrompts.tsx` ‚Äî –∑–∞–º–µ–Ω–µ–Ω—ã motion-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ CSS —Å `animate-fade-in`
   - `ChatSidebar.tsx` ‚Äî —É–¥–∞–ª–µ–Ω–∞ `AnimatePresence`, –¥–æ–±–∞–≤–ª–µ–Ω—ã CSS-–ø–µ—Ä–µ—Ö–æ–¥—ã
   - `ChatSidebarItem.tsx` ‚Äî –∑–∞–º–µ–Ω–µ–Ω—ã motion-–∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ Tailwind CSS –∫–ª–∞—Å—Å—ã

3. ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω—ã CSS-–∞–Ω–∏–º–∞—Ü–∏–∏** –≤ `tailwind.config.js`:

   ```js
   keyframes: {
     fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
     fadeOut: { '0%': { opacity: '1', transform: 'translateY(0)' }, '100%': { opacity: '0', transform: 'translateY(10px)' } },
     scaleIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' } }
   }
   ```

4. ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∞ CSP –ø–æ–ª–∏—Ç–∏–∫–∞:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `'unsafe-eval'` –∏–∑ –≤—Å–µ—Ö CSP-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:
   - `packages/neira-app/lib/utils/csp-utils.ts`
   - `packages/neira-app/app/layout.tsx`  
   - `packages/neira-app/pages/_document.tsx`

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å CSP
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞ –∑–∞ —Å—á–µ—Ç –æ—Ç–∫–∞–∑–∞ –æ—Ç —Ç—è–∂–µ–ª–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ–ø—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** CSP —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ `'unsafe-eval'` –¥–∞–∂–µ –≤ development —Ä–µ–∂–∏–º–µ

### –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SECURITY:REFACTORING)

**–ú–∞—Å—à—Ç–∞–±–Ω–∞—è –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:**

#### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞

- **–¢–∏–ø—ã Chrome Extensions**: –£–¥–∞–ª–µ–Ω `chrome-legacy.d.ts`, —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã `adm-zip.d.ts` –≤ `shared-types`
- **Deprecated —Ñ—É–Ω–∫—Ü–∏–∏**: –ó–∞–º–µ–Ω–∞ `getUserIdAsync/getId/updateUserId` ‚Üí `useUserId()`, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–µ Electron API
- **–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è API**: –ó–∞–º–µ–Ω–∞ –∑–∞–≥–ª—É—à–µ–∫ `chrome.downloads` –∏ `chrome.debugger` –Ω–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥

- **TaskExecutionService**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞ –±–µ–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Chrome Extensions API –∏ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ TaskExecutionService (SECURITY:CRITICAL_DEFECTS_CLEANUP)

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ —Ä–∏—Å–∫–∏ –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**

1. ‚úÖ **–°–æ–∑–¥–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç** `tests/1_integration/task-execution-service.spec.ts`
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
3. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. ‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â• 85%** ‚Äî –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Ç–∏–ø–æ–≤ –≤ `shared-types` –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `@types/chrome` –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
- –ó–∞–º–µ–Ω–∞ deprecated —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `useUserId()` —Ö—É–∫)
- –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Chrome Extensions API (`chrome.downloads`, `chrome.debugger`)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞—â–∏—Ç–æ–π –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π –∫–æ–º–∞–Ω–¥ –∏ –ø–æ–ª–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å Chrome Extensions.

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π P0 (SECURITY:CRITICAL_VULNERABILITIES_FIX)

**–ú–∞—Å—à—Ç–∞–±–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

#### –£–¥–∞–ª–µ–Ω–∏–µ hardcoded API-–∫–ª—é—á–µ–π

- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å P0 ‚Äî hardcoded API-–∫–ª—é—á Gladia –≤ `manager.ts`
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ hardcoded –∫–ª—é—á–µ–π, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ApiKeyStore`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ API-–∫–ª—é—á–µ–π

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

- **–ü—Ä–æ–±–ª–µ–º–∞:** –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ –º–µ—Ö–∞–Ω–∏–∑–º–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —á–µ—Ä–µ–∑ `setInterval`
- **–†–µ—à–µ–Ω–∏–µ:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

#### –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Chrome Extensions

- **–ü—Ä–æ–±–ª–µ–º–∞:** `chrome.storage.local` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `MemoryStorageArea`, —Ç–µ—Ä—è—è –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- **–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### –ì–¥–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è CSP

| –°–ª–æ–π                  | –§–∞–π–ª/–º–µ—Ç–æ–¥                                   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                       |
| --------------------- | -------------------------------------------- | -------------------------------------------------------------------------------- |
| **Electron (main)**   | `WindowManager.setupContentSecurityPolicy()` | CSP –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —á–µ—Ä–µ–∑ `session.webRequest.onHeadersReceived`     |
| **Renderer / UI**     | `packages/neira-app/app/layout.tsx`          | `<meta httpEquiv="Content-Security-Policy">` –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ UI |
| **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∞–π—Ç—ã** | `scripts/remove-csp-meta.js`                 | –£–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ CSP-–º–µ—Ç–∞—Ç–µ–≥–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö HTML                                |

#### –¢–µ–∫—É—â–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞

```
script-src   'self' 'nonce-${cspNonce}' https: neira: file:;
style-src    'self' 'nonce-${cspNonce}' https: data:;
img-src      'self' data: blob: https: neira: file:;
connect-src  'self' https: wss: data: neira: file:;
object-src   'none';
```

#### CSP —Ö—ç—à–∏ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ CSP —Ö—ç—à–µ–π:**

- –§–∞–π–ª `generated/csp-hashes.json` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ Next.js
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –≤ runtime –ø–æ –ø—É—Ç–∏ `neira://view/generated/csp-hashes.json`
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback CSP —Å `'unsafe-inline'`

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏:**

```bash
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–∞–Ω–¥
next build && next export  # –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
generate-csp-hashes.js     # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏ —Å–æ–∑–¥–∞–µ–º —Ö—ç—à–∏ –≤ out/
```

**DynamicCSP –∑–∞–≥—Ä—É–∑–∫–∞:**

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö—ç—à–µ–π –≤ runtime
const hashesResponse = await fetch('/generated/csp-hashes.json')
if (hashesResponse.ok) \{
  // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç—Ä–æ–≥—É—é CSP —Å —Ö—ç—à–∞–º–∏
  applyStrictCSP(hashes)
} else \{
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—É—é CSP —Å 'unsafe-inline'
  logger.warn('CSP hashes not available, using fallback CSP')
}
```

### 3. –ó–∞—â–∏—Ç–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (`neira://`)

–ü—Ä–æ—Ç–æ–∫–æ–ª `neira://` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`neira-app`, `docs-site`). –û–Ω –∑–∞—â–∏—â–µ–Ω –æ—Ç –∞—Ç–∞–∫ **Path Traversal**.

#### –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã

- **–ù–∏–∫–∞–∫–∏—Ö `..`:** –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.
- **–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:** URL-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (`%2e%2e%2f`) —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–µ–∫–æ–¥–∏—Ä—É—é—Ç—Å—è, —á—Ç–æ–±—ã –≤—ã—è–≤–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—Ö–æ–¥–∞.
- **–ö–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π:** `path.resolve()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏ –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π, —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—É—Ç—å.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü:** –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –ø—É—Ç—å **—Å—Ç—Ä–æ–≥–æ** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`resources`).

```typescript
// packages/shell/src/main/protocol-handler.ts

// 1. –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º URL
let decodedPathname = decodeURIComponent(pathname);
// ... (—Ü–∏–∫–ª –¥–æ –ø–æ–ª–Ω–æ–≥–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è)

// 2. –†–∞–∑—Ä–µ—à–∞–µ–º –ø—É—Ç–∏ –¥–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö
const baseStaticResolved = path.resolve(baseStatic);
const requestedPathResolved = path.resolve(baseStatic, decodedPathname);

// 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –ø—É—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–∞–∑–æ–≤–æ–≥–æ
if (!requestedPathResolved.startsWith(baseStaticResolved)) \{
  // ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
  return callback(\{ error: -6 });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≠—Ç–æ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ `resources`.

### 4. –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (IPC)

- **–ü—Ä–∏–Ω—Ü–∏–ø "IPC-First"**: –ù–∏–∫–∞–∫–æ–≥–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ `shell` –∏–∑ `neira-app`, –∫—Ä–æ–º–µ –∫–∞–∫ —á–µ—Ä–µ–∑ `window.neiraAPI`.
- **–°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤**: –í—Å–µ `invoke`-–∫–∞–Ω–∞–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —è–≤–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ `allowed-channels.json`, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–∑ `shared-types`. –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–æ–≤–∞ –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
- **–ù–∏–∫–∞–∫–∏—Ö `executeJavaScript`**: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ `shell`.

### 5. –•—Ä–∞–Ω–µ–Ω–∏–µ API-–∫–ª—é—á–µ–π (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ fallback –Ω–∞ `localStorage`)

- **–ü—Ä–∞–≤–∏–ª–æ:** –°–µ–∫—Ä–µ—Ç—ã (API-–∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã) **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `localStorage`/`sessionStorage`.
- **–¢–æ—á–∫–∞ –∏—Å—Ç–∏–Ω–Ω—ã:** –ö–ª—é—á–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ IPC –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ main-–ø—Ä–æ—Ü–µ—Å—Å–∞ (`ApiKeyStore`). UI-—Å–ª–æ–π –ø–æ–ª—É—á–∞–µ—Ç –∫–ª—é—á–∏ —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ `window.neiraAPI`.
- **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:** –í —Å–ø—Ä–∏–Ω—Ç–µ **SEC-02** (–∏—é–ª—å 2025) –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω fallback-–º–µ—Ö–∞–Ω–∏–∑–º `localStorage` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `ApiKeyManager`. –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. –ø—É–Ω–∫—Ç ¬´Phase 1 ‚Äî –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è¬ª –≤ –æ—Ç—á–µ—Ç–∞—Ö DOCBUILDER.
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç `api-manager.spec.ts` –∏ —Ä—É—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ Electron-—Å–±–æ—Ä–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ `localStorage`, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç XSS-—Ä–∏—Å–∫–∏ –∫—Ä–∞–∂–∏ –∫–ª—é—á–µ–π.

## üîß –ü—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ CSP

1. –û–±—Å—É–¥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ PR ‚Äî —Ç–µ–≥ `security`.
2. –ò–∑–º–µ–Ω–∏ **–æ–±–∞** –º–µ—Å—Ç–∞: `WindowManager` (–∑–∞–≥–æ–ª–æ–≤–æ–∫) –∏ `layout.tsx` (–º–µ—Ç–∞-—Ç–µ–≥).
3. –û–±–Ω–æ–≤–∏ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî —Ä–∞–∑–¥–µ–ª _Changelog_.
4. –ó–∞–ø—É—Å—Ç–∏ —Ä–µ–≥—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã: `yarn test:ci tests/regression/csp-*`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö IPC –∫–∞–Ω–∞–ª–æ–≤

1. –î–æ–±–∞–≤—å —Ç–∏–ø—ã –≤ `shared-types/ipc.ts`
2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π `allowed-channels.json`: `yarn build:types`
3. –î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä
4. –î–æ–±–∞–≤—å —Ç–µ—Å—Ç—ã –≤ `tests/0_unit/ipc/`

---

–≠—Ç–∏ —á–µ—Ç—ã—Ä–µ —Å—Ç–æ–ª–ø–∞ ‚Äî **Sandbox, CSP, –∑–∞—â–∏—Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π IPC** ‚Äî —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤—É –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã NEIRA Super App.
