# Сервис обновления расширений

## 1. Назначение

Сервис обновления отвечает за автоматическую проверку и установку обновлений для установленных расширений Chrome. Это критически важный компонент для поддержания безопасности и функциональности расширений.

## 2. Архитектура и жизненный цикл

- **Инициализация:** Сервис инициализируется один раз при старте приложения, обычно внутри `ExtensionsManager`.
- **Периодическая проверка:** Для проверки обновлений используется `setInterval`.
- **Уничтожение:** Таймер `setInterval` должен быть надежно очищен с помощью `clearInterval` при завершении работы приложения (например, в методе `_destroy` менеджера), чтобы избежать утечек памяти.

## 3. Устраненная уязвимость: Утечка памяти

В ранних версиях существовала **критическая утечка памяти**, связанная с сервисом обновления.

**Проблема:**

- Логика управления `setInterval` была ненадежной и основывалась на глобальной переменной.
- Это приводило к созданию множественных, "осиротевших" интервалов, которые никогда не очищались и потребляли ресурсы.

**Решение:**

- Управление интервалом было полностью инкапсулировано внутри `ExtensionsManager`.
- Логика была переписана так, чтобы гарантировать создание только одного интервала на протяжении всего жизненного цикла приложения.
- Была добавлена надежная процедура очистки таймера в методе `_destroy` менеджера.

**Результат:**
Утечка памяти была полностью устранена, что значительно повысило стабильность и производительность `shell` в долгосрочной перспективе.

## 4. Ключевые принципы разработки

- **Инкапсуляция:** Вся логика, связанная с таймерами и подписками, должна быть инкапсулирована внутри класса, который ей управляет.
- **Надежная очистка ресурсов:** Всегда предусматривайте механизм очистки для `setInterval`, `setTimeout`, обработчиков событий и других ресурсов, которые могут вызывать утечки.
