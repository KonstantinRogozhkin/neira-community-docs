# üåê Web API Reference

**–í–µ—Ä—Å–∏—è:** 1.0 (Initial Draft)
**–°—Ç–∞—Ç—É—Å:** üü° **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç REST API, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π –ø–∞–∫–µ—Ç–æ–º `web-api`. API —Å–ª—É–∂–∏—Ç "—Ç–æ–Ω–∫–∏–º" HTTP-–∞–¥–∞–ø—Ç–µ—Ä–æ–º –¥–ª—è `polylith-backend`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞–º –¥–æ—Å—Ç—É–ø –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ NEIRA Super App.

- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** Express.js
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** JWT Bearer Token
- **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:** JSON

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (`packages/web-api/src/routes/chats.ts`) –≤—ã–∑–æ–≤—ã –∫ `backendApi` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ mock-–æ–±—ä–µ–∫—Ç. –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å `@neira/polylith-backend`.

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º `/api/*` –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization`.

```
Authorization: Bearer <YOUR_JWT_TOKEN>
```

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (`NODE_ENV=development`) —Ç–æ–∫–µ–Ω –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `userId: 'dev-user-123'`.

---

## ‚ù§Ô∏è Health Check

–≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞. –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### `GET /health`

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞, –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.
- **–û—Ç–≤–µ—Ç `200 OK`:**

  ```json
  {
    "status": "OK",
    "timestamp": "2025-07-26T10:00:00.000Z",
    "environment": "development",
    "version": "1.0.0"
  }
  ```

---

## üí¨ –ß–∞—Ç—ã (`/api/chats`)

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### `GET /api/chats`

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **–û—Ç–≤–µ—Ç `200 OK`:**

  ```json
  {
    "success": true,
    "data": [
      { "id": "chat-1", "title": "My first chat", "messages": [...] },
      { "id": "chat-2", "title": "My second chat", "messages": [...] }
    ],
    "total": 2
  }
  ```

### `GET /api/chats/:id`

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Ç –ø–æ –µ–≥–æ ID.
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:**
  - `id` (string, required): ID —á–∞—Ç–∞.
- **–û—Ç–≤–µ—Ç `200 OK`:**

  ```json
  {
    "success": true,
    "data": {
      "id": "chat-1",
      "title": "My first chat",
      "messages": [
        { "role": "user", "content": "Hello" },
        { "role": "assistant", "content": "Hi there!" }
      ]
    }
  }
  ```

- **–û—Ç–≤–µ—Ç `404 Not Found`:**

  ```json
  { "error": "Chat not found" }
  ```

### `POST /api/chats`

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π. –ï—Å–ª–∏ `id` –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —á–∞—Ç.
- **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

  ```json
  {
    "id": "chat-1", // (string, optional)
    "title": "Updated Chat Title", // (string, optional)
    "messages": [
      // (Message[], required)
      { "role": "user", "content": "Hello again" }
    ]
  }
  ```

- **–û—Ç–≤–µ—Ç `201 Created` (–¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞):**

  ```json
  {
    "success": true,
    "data": { "id": "new-chat-id" },
    "action": "created"
  }
  ```

- **–û—Ç–≤–µ—Ç `200 OK` (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è):**

  ```json
  {
    "success": true,
    "data": { "id": "chat-1" },
    "action": "updated"
  }
  ```

### `DELETE /api/chats/:id`

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å —á–∞—Ç –ø–æ ID.
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:**
  - `id` (string, required): ID —á–∞—Ç–∞.
- **–û—Ç–≤–µ—Ç `200 OK`:**

  ```json
  {
    "success": true,
    "message": "Chat deleted successfully",
    "id": "chat-1"
  }
  ```

---

## üåä –°—Ç—Ä–∏–º–∏–Ω–≥ —á–∞—Ç–∞ (`/api/chat`)

–≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç AI.

### `POST /api/chat/stream`

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç Server-Sent Events (SSE) —Å—Ç—Ä–∏–º –¥–ª—è –æ—Ç–≤–µ—Ç–∞ AI –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π.
- **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

  ```json
  {
    "chatId": "chat-1", // (string, optional)
    "model": "gpt-4", // (string, optional)
    "messages": [
      // (Message[], required)
      { "role": "user", "content": "Tell me a story" }
    ]
  }
  ```

- **–û—Ç–≤–µ—Ç `200 OK` (SSE Stream):**
  - **Content-Type:** `text/event-stream`
  - **–°–æ–±—ã—Ç–∏—è (Events):**
    - **`ping`**: –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

      ```
      data: {"type":"ping","timestamp":"..."}
      ```

    - **`chunk`**: –§—Ä–∞–≥–º–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI.

      ```
      data: {"type":"chunk","id":"stream-id","content":"Once upon a time..."}
      ```

    - **`done`**: –°–∏–≥–Ω–∞–ª –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç—Ä–∏–º–∞.

      ```
      data: {"type":"done","id":"stream-id","timestamp":"..."}
      ```

    - **`error`**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤–æ –≤—Ä–µ–º—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.

      ```
      data: {"type":"error","id":"stream-id","error":"Something went wrong"}
      ```

  - –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `data: <JSON_STRING>\n\n`.
