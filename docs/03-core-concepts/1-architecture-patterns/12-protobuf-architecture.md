# üì¶ Protobuf Architecture

**–í–µ—Ä—Å–∏—è:** 2025-08-05 **–°—Ç–∞—Ç—É—Å:** ‚úÖ Canonical

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Protocol Buffers (protobuf) –≤ NEIRA Super App –¥–ª—è —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

---

## 1. –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã

Protocol Buffers –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ NEIRA Super App –¥–ª—è:

1. **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ gRPC-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ** –º–µ–∂–¥—É Node.js –∏ Python-–∞–≥–µ–Ω—Ç–æ–º
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è Chrome Extensions
3. **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
4. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã** –¥–ª—è –≤—Å–µ—Ö —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–Ω—Ü–∏–ø SSOT (Single Source of Truth):** –í—Å–µ proto-—Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `proto/` –∏ —è–≤–ª—è—é—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞.

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
proto/
‚îú‚îÄ‚îÄ agent.proto                # gRPC-—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è Python-–∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ chrome-extensions.proto    # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Chrome Extensions
‚îî‚îÄ‚îÄ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º

packages/
‚îú‚îÄ‚îÄ shell/                     # –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ gRPC-—Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ electron-chrome-web-store/ # –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ chrome-extensions —Ç–∏–ø–æ–≤
‚îî‚îÄ‚îÄ python_api/               # Python-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è gRPC-—Å–µ—Ä–≤–∏—Å–æ–≤
```

---

## 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

### 3.1 –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–í—Å–µ TypeScript-—Ç–∏–ø—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `.proto` —Ñ–∞–π–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–æ–≤:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–ª—è Chrome Extensions
yarn proto:gen:chrome-extensions

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC-–∫–ª–∏–µ–Ω—Ç–æ–≤/—Å–µ—Ä–≤–µ—Ä–æ–≤
yarn proto:gen:agent
```

### 3.2 Chrome Extensions

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `proto/chrome-extensions.proto`  
**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:** `packages/electron-chrome-web-store/src/types/crx3-generated.ts`

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã
export interface SignedData {
  crxId?: Uint8Array;
  publicKeyInfo?: AsymmetricKeyProof[];
  signature?: Uint8Array;
}
```

### 3.3 Python Agent gRPC

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `proto/agent.proto`  
**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:** TypeScript –∫–ª–∏–µ–Ω—Ç—ã –≤ `packages/shell/` –∏ Python —Å–µ—Ä–≤–µ—Ä—ã –≤ `python_api/`

---

## 4. –ú–∏–≥—Ä–∞—Ü–∏—è –∫ SSOT (2025-07)

### 4.1 –ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ proto-—Ñ–∞–π–ª–æ–≤ (`packages/electron-chrome-web-store/src/browser/crx3.proto` –¥—É–±–ª–∏—Ä–æ–≤–∞–ª `proto/chrome-extensions.proto`), —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞.

**–†–µ—à–µ–Ω–∏–µ:**

1. –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ `proto/chrome-extensions.proto`
2. –ü–æ–º–µ—á–µ–Ω –∏—Å—Ö–æ–¥–Ω—ã–π `crx3.proto` –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π
3. –î–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ TypeScript –∫–æ–¥–∞
4. –°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª —Å –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
5. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º—ã—Ö –º–æ–¥—É–ª—è—Ö

### 4.2 –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏

- ‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã** –¥–ª—è –≤—Å–µ—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
- ‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞** –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞

---

## 5. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 5.1 –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

| –ö–æ–Ω—Ç–µ–∫—Å—Ç | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è | –ò–º–ø–æ—Ä—Ç |
|----------|----------|-----------|---------|
| Chrome Extensions | `proto/chrome-extensions.proto` | `crx3-generated.ts` | `import { SignedData } from '@/types/crx3-generated'` |
| Python gRPC | `proto/agent.proto` | –ê–≤—Ç–æ —á–µ—Ä–µ–∑ protoc | `import agent_pb2` |
| TypeScript gRPC | `proto/agent.proto` | –ê–≤—Ç–æ —á–µ—Ä–µ–∑ @grpc/tools | `import { AgentClient } from '@/grpc/agent'` |

### 5.2 –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã (—É—Å—Ç—Ä–∞–Ω–µ–Ω—ã)

| ‚ùå –ü–ª–æ—Ö–æ (–¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞) | ‚úÖ –•–æ—Ä–æ—à–æ (–ø–æ—Å–ª–µ SSOT) |
|----------------------------|-------------------------|
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ .proto —Ñ–∞–π–ª–æ–≤ | –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ `proto/` |
| –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ | –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è |
| –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º | –ï–¥–∏–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ |

---

## 6. Troubleshooting

### 6.1 –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| –¢–∏–ø—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã | –ù–µ –∑–∞–ø—É—â–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | –í—ã–ø–æ–ª–Ω–∏—Ç—å `yarn proto:gen:*` |
| –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ç–∏–ø—ã | –°—Ç–∞—Ä—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã | –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö .proto |
| Import –æ—à–∏–±–∫–∏ | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö |

### 6.2 –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ .proto —Ñ–∞–π–ª–æ–≤
protoc --proto_path=proto --lint_out=. proto/*.proto

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
buf breaking --against='.git#branch=main'
```

---

## 7. Revision History

| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | ID –ó–Ω–∞–Ω–∏—è |
|------|--------|-----------|-----------|
| 2025-08-05 | 1.0 | –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ SSOT-–º–∏–≥—Ä–∞—Ü–∏–∏ | PROTO:SSOT_CONSOLIDATION |

---

## 8. –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Manager Architecture](/core-concepts/architecture-patterns/manager-architecture) ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ gRPC –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö
- [Python Integration](/core-concepts/ai-engine/python-integration) ‚Äî gRPC-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Python
- [Chrome Extensions](/reference/chrome-extensions) ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ protobuf-—Å—Ç—Ä—É–∫—Ç—É—Ä
