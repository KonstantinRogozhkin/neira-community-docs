<!-- –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —É–ø—Ä–∞–≤–ª—è–µ–º—É—é ProxyManager. -->

# üîó –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è AI API

## –û–±–∑–æ—Ä

NEIRA Super App –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è AI API, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ API –∫–ª—é—á–∏, –∫–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é —Ä–∞–±–æ—Ç—É AI-—Ñ—É–Ω–∫—Ü–∏–π –¥–∞–∂–µ –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö API –∫–ª—é—á–µ–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ó–∞ –¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞–µ—Ç `ProxyManager`, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π `ProxyService`.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **ProxyService** (`packages/shell/src/main/managers/services/ProxyService.ts`)

   - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–º
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ backend
   - Retry –ª–æ–≥–∏–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

2. **APIManager** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π AI pipeline

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É –ø—Ä—è–º—ã–º–∏ API –∏ –ø—Ä–æ–∫—Å–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

3. **ProxyStatus** (`packages/neira-app/components/common/ProxyStatus.tsx`)
   - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–∫—Å–∏
   - –î–æ—Å—Ç—É–ø–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø fallback

```mermaid
flowchart TD
    A[–ó–∞–ø—Ä–æ—Å –∫ AI] --> B\{–ï—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏?}
    B -->|–î–∞| C[–ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞]
    B -->|–ù–µ—Ç| D\{–ù–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä?}
    D -->|–î–∞| E[–ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä]
    D -->|–ù–µ—Ç| F[–û—à–∏–±–∫–∞: API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω]
    C --> G[–û—Ç–≤–µ—Ç AI]
    E --> H\{–ü—Ä–æ–∫—Å–∏ –¥–æ—Å—Ç—É–ø–µ–Ω?}
    H -->|–î–∞| G
    H -->|–ù–µ—Ç| I[Fallback error]
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏
NEIRA_BACKEND_URL=https://api.neira.sale

# –õ–æ–∫–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –ø—Ä–æ–∫—Å–∏)
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
OPENROUTER_API_KEY=your_openrouter_key
```

### –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∫—Å–∏

–ü—Ä–æ–∫—Å–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏:

1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏** –¥–ª—è —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. **–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è** `NEIRA_BACKEND_URL`
3. **–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω** (–ø—Ä–æ—Ö–æ–¥–∏—Ç health check)

## API –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞

### Health Check

```http
GET /health
Response: \{"status": "ok", "timestamp": "2025-01-26T15:30:00Z"}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

```http
POST /api/v1/chat/completions
Headers: User-Agent: NEIRA-SuperApp/1.0.0, X-Client-ID: neira-super-app
```

**–ó–∞–ø—Ä–æ—Å:**

```json
\{
  "model": "gpt-4o-mini",
  "messages": [\{"role": "user", "content": "Hello!"}],
  "maxTokens": 1000,
  "temperature": 0.7,
  "userId": "user-123"
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### IPC API –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```typescript
const proxyStats = await window.neiraAPI.invoke('api-proxy-stats')
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {isAvailable: boolean, backendUrl: string, healthStatus: boolean}
```

### UI –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `ProxyStatus` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:

- ‚úÖ **–ê–∫—Ç–∏–≤–µ–Ω** - –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚ùå **–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚ö™ **–û—Ç–∫–ª—é—á–µ–Ω** - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NEIRA_BACKEND_URL` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```
üîó [ProxyService] Initialized with backend URL: https://api.neira.sale
üîó [ProxyService] Sending request to proxy backend: {model: gpt-4o-mini}
üîó [ProxyService] Successfully received response from proxy backend
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Retry –º–µ—Ö–∞–Ω–∏–∑–º

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã** –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- **–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- **–ú–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏** - –ø–æ–≤—Ç–æ—Ä —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
2. **HTTP –æ—à–∏–±–∫–∏** (4xx, 5xx) - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏
3. **Timeout** - –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
4. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç** - –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞–≥–æ–ª–æ–≤–∫–∏

- `User-Agent: NEIRA-SuperApp/1.0.0` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- `X-Client-ID: neira-super-app` - ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `X-Request-ID: req_...` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø—Ä–æ—Å–∞

### Timeout

- **Health check**: 5 —Å–µ–∫—É–Ω–¥
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: 30 —Å–µ–∫—É–Ω–¥
- **AbortController** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç–º–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ UI

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```typescript
import \{ ProxyStatus } from '@/components/common/ProxyStatus'

// –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
`<ProxyStatus />`

// –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –±–µ–π–¥–∂
`<ProxyStatus showDetails={false} />`
```

### –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ø–æ –∫–ª–∏–∫—É "–û–±–Ω–æ–≤–∏—Ç—å" –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export NEIRA_BACKEND_URL=http://localhost:8080

# 2. –£–±—Ä–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏
unset OPENAI_API_KEY ANTHROPIC_API_KEY

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
yarn start:fast
```

### Unit —Ç–µ—Å—Ç—ã

```bash
npx vitest run packages/shell/src/main/managers/services/__tests__/ProxyService.test.ts
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ProxyService instance
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑—É–º–Ω—ã–µ timeout'—ã
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ retry –ª–æ–≥–∏–∫—É

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ health check
- ‚úÖ –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫

### UX

- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–∫—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –û–±—ä—è—Å–Ω—è–π—Ç–µ –∑–∞—á–µ–º –Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ fallback –æ–ø—Ü–∏–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è AI API –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç seamless –æ–ø—ã—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π NEIRA Super App, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –¥–æ—Å—Ç—É–ø –∫ AI-—Ñ—É–Ω–∫—Ü–∏—è–º –¥–∞–∂–µ –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö API –∫–ª—é—á–µ–π. –°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
