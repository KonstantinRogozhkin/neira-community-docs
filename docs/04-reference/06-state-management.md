# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

**–í–µ—Ä—Å–∏—è:** 2.0 | **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç | **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-07-01

## ‚ö° –§–∏–ª–æ—Å–æ—Ñ–∏—è

NEIRA Super App –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å–æ—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ `shell` (main-–ø—Ä–æ—Ü–µ—Å—Å) —è–≤–ª—è–µ—Ç—Å—è **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã (SSOT)**, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ `neira-app` (UI) –æ—Å—Ç–∞–µ—Ç—Å—è –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–º, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–º –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º.

## üèõÔ∏è –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1.  **`shell` (Main Process) State**: –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –≤—Å–µ–≥–æ, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –±—ç–∫–µ–Ω–¥-–ª–æ–≥–∏–∫–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `MCPManager`, `APIManager`).
2.  **`neira-app` Cached Server State (React Query)**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ `shell` –ø–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º IPC-–∫–∞–Ω–∞–ª–∞–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤).
3.  **`neira-app` UI State (Zustand)**: –≠—Ñ–µ–º–µ—Ä–Ω–æ–µ, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ UI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–∫—Ä—ã—Ç–∞ –ª–∏ –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å, —Ç–µ–∫—É—â–∞—è —Ç–µ–º–∞).

---

## 1. Main Process: The Single Source of Truth (SSOT)

–í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `shell`.

- **–ü—Ä–∏–º–µ—Ä: `MCPManager`**
  - –•—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤, —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.
  - –ü–µ—Ä—Å–∏—Å—Ç–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ `electron-store`.
  - –£–≤–µ–¥–æ–º–ª—è–µ—Ç UI –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ `webContents.send()`.

UI **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é. –û–Ω –ª–∏—à—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã (`invoke`) –¥–ª—è –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

## 2. React Query: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö IPC-–¥–∞–Ω–Ω—ã—Ö

React Query ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —É `shell`.

### –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã

```typescript
// lib/ipc-api.ts
export const chatsAPI = \{
  getList: () => window.neiraAPI.invoke('chats:list'),
  getMessages: (chatId: string) => window.neiraAPI.invoke('chats:messages', chatId)
}
```

### –•—É–∫–∏ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```typescript
export const useChats = () => \{
  return useQuery(\{
    queryKey: ['chats'],
    queryFn: chatsAPI.getList,
    staleTime: 5 * 60 * 1000,  // 5 –º–∏–Ω –∫–µ—à
    gcTime: 10 * 60 * 1000,  // 10 –º–∏–Ω garbage collection
  })
}
```

## 3. Zustand: –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ UI-—Å–æ—Å—Ç–æ—è–Ω–∏–µ

Zustand –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–≥–æ, –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –¥–ª—è UI.

### –ü—Ä–∏–º–µ—Ä: `useUIStore`

```typescript
// lib/store/uiStore.ts
const useUIStore = create<UIState>()(
  persist(
    (set) => (\{
      sidebar: \{ isOpen: true },
      // ...
    }),
    \{
      name: 'ui-store',
      // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é UI
      partialize: (state) => (\{
        sidebar: \{ isOpen: state.sidebar.isOpen },
        theme: state.theme
      })
    }
  )
)
```

### –ü–∞—Å—Å–∏–≤–Ω—ã–π UI-—Å—Ç–æ—Ä –¥–ª—è MCP

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ `shell`, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π "–ø–∞—Å—Å–∏–≤–Ω—ã–π" —Å—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–ª—å–∫–æ —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è.

```typescript
// features/mcp/hooks/useMCPPassiveStore.ts
// ...
export const useMCPPassiveStore = create<MCPState>((set) => (\{
  // ... –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ...
  initializeListener: () => \{
    window.neiraAPI.on('mcp:state-update', (newState) => \{
      set(newState); // –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–æ—Ä –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ main
    });
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    window.neiraAPI.invoke('mcp:getSystemState').then(set);
    return () => window.neiraAPI.off('mcp:state-update');
  }
}));
```

–≠—Ç–æ—Ç —Ö—É–∫ **–Ω–µ –∏–º–µ–µ—Ç actions** –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–Ω ‚Äî –ø–∞—Å—Å–∏–≤–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–æ `MCPManager`.

## üåü –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ö–æ–º–ø–æ–∑–∏—Ü–∏—è —Ö—É–∫–æ–≤

–î–ª—è –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏—á, —Ç–∞–∫–∏—Ö –∫–∞–∫ —á–∞—Ç, –º—ã –ø—Ä–∏–º–µ–Ω—è–µ–º **–∫–æ–º–ø–æ–∑–∏—Ü–∏—é —Ö—É–∫–æ–≤**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å "God Hooks".

- **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è "God Hook"**: –û—Å–Ω–æ–≤–Ω–æ–π —Ö—É–∫ (`useChatCore`) —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª–µ–µ –º–µ–ª–∫–∏—Ö, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ö—É–∫–æ–≤.
- **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä**: `useChatCore` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º", –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç–∏ —Ö—É–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –Ω–∏–º–∏.

### –ü—Ä–∏–º–µ—Ä –Ω–∞ `useChatCore`

–ö–æ–º–ø–æ–∑–∏—Ü–∏—è —Ö—É–∫–æ–≤ ‚Äî **–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏—á –≤ `neira-app`. –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

```typescript
// packages/features/chat/hooks/useChatCore.ts

// 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ö—É–∫–∏
import \{ useChatState } from './useChatState';
import \{ useMCPIntegration } from './useMCPIntegration';
import \{ useChatSession } from './useChatSession';
import \{ useChatInputHandlers } from './useChatInputHandlers';

// 2. useChatCore —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
export const useChatCore = (props) => \{
  // –ö–∞–∂–¥—ã–π —Ö—É–∫ —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É
  const chatState = useChatState(props);             // UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ (Zustand)
  const mcpIntegration = useMCPIntegration();        // MCP –¥–∞–Ω–Ω—ã–µ (–∏–∑ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ —Å—Ç–æ—Ä–∞)
  const chatSession = useChatSession(props);         // –ò—Å—Ç–æ—Ä–∏—è, –∫–µ—à (React Query)
  const inputHandlers = useChatInputHandlers(/* ... */); // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–≤–æ–¥–∞

  // 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–¥–∏–Ω—ã–π, –ø—Ä–æ—Å—Ç–æ–π API –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  return \{ /* ... –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ props –∏ —Ö–µ–Ω–¥–ª–µ—Ä—ã ... */ };
}
```

## üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞

1.  **SSOT –≤ `shell`**: –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ç—Ä–µ–±—É—é—â–∞—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º, –∂–∏–≤–µ—Ç –≤ `shell` –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Manager`.
2.  **IPC –¥–ª—è –∫–æ–º–∞–Ω–¥**: UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ `shell` —á–µ—Ä–µ–∑ `window.neiraAPI.invoke()`.
3.  **IPC –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**: `shell` –ø—É—à–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ UI —á–µ—Ä–µ–∑ `window.neiraAPI.on()`.
4.  **React Query –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `useQuery` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è "—Å—Ç–∞—Ç–∏—á–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –∏–∑ `shell` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤).
5.  **Zustand –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è UI**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Zustand –¥–ª—è –≤—Å–µ–≥–æ, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ç–µ–º—ã, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–∞–ª–æ–∫, –∏ —Ç.–¥.).

## üîë –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –•—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ MCP (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤) –≤ `neira-app`.
‚ùå **–ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –∏–∑ UI**: –ü—ã—Ç–∞—Ç—å—Å—è —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª–∞–º–∏ –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
‚ùå **Runtime –≤ `persist`**: –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `localStorage` –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤—Ä–æ–¥–µ `status: 'connected'`.
‚ùå **useState –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useState` –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –Ω—É–∂–Ω—ã—Ö –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (Phase 3 Legacy Migration) –∏ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –¥–ª—è –≤—Å–µ–≥–æ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞.

## üíé –ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ Zustand (Daebak 2.0)

> –≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è **"Zustand SSR & Infinite Loop"** (2025-06-18) –∏ —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –¥–ª—è –≤—Å–µ–≥–æ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞.

| ‚Ññ   | –ü—Ä–∞–≤–∏–ª–æ                                                                                                           | –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ                                                        |
| --- | ----------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| 1   | **SSR-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ª—é–±–æ–π –¥–æ—Å—Ç—É–ø –∫ `window` / `document` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–µ—Ä–Ω—É—Ç –≤ `typeof window !== 'undefined'`. | –ò–∑–±–µ–≥–∞–µ—Ç –∫—Ä—ç—à–µ–π –ø—Ä–∏ static export / prerender.                      |
| 2   | **–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã**: –ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–∏–º–∏—Ç–∏–≤—ã (`state => state.field`).                           | –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ ‚Üí –º–µ–Ω—å—à–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ ‚Üí –Ω–µ—Ç "stale closure" –æ—à–∏–±–æ–∫. |
| 3   | **–ù–µ—Ç "self-update" —ç—Ñ—Ñ–µ–∫—Ç–æ–≤**: –Ω–µ –≤–∫–ª—é—á–∞–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å—Ç–æ—Ä–∞ –≤ `useEffect` –µ—Å–ª–∏ —ç—Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç —Å–∞–º –º–µ–Ω—è–µ—Ç —Å—Ç–æ—Ä.    | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç `Maximum update depth exceeded`.                      |

### –®–∞–±–ª–æ–Ω –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤
const input = useChatSessionStore((s) => s.input)
const inputMode = useChatSessionStore((s) => s.inputMode)

// ‚ùå –ù–ï –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫: —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∫–∞–∂–¥—ã–π —Ä–µ–Ω–¥–µ—Ä
// const { input, inputMode } = useChatSessionStore(s => ({ input: s.input, inputMode: s.inputMode }))
```

–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–µ–≤—å—é –∏ –ª–∏–Ω—Ç–∏—Ç—å—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ `eslint-plugin-zustand` (—Å–º. —Ä–∞–∑–¥–µ–ª Contributing).
