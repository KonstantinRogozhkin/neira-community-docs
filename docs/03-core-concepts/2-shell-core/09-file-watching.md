# üìÇ File Watching Architecture

**–í–µ—Ä—Å–∏—è:** 2025-07-01 **–°—Ç–∞—Ç—É—Å:** ‚úÖ Canonical

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ NEIRA Super App –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å VS Code –∏ —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## 1. –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã

–§–∞–π–ª–æ–≤–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö:

1. **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî –µ–¥–∏–Ω—ã–π API –¥–ª—è –≤—Å–µ—Ö –û–°
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ polling
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** ‚Äî graceful fallback –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ API
4. **–†–µ—Å—É—Ä—Å–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏

**–û—Å–Ω–æ–≤–∞:** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `chokidar` –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
graph TD
    subgraph "Shell (Main Process)"
        CM[CodeOSSManager]
        FW[File Watcher]
    end
    
    subgraph "Chokidar Backends"
        FS[fsevents (macOS)]
        RW[ReadDirectoryChanges (Windows)]
        IN[inotify (Linux)]
        PL[Polling (Universal)]
    end
    
    subgraph "VS Code Integration"
        VSC[VS Code Instance]
        EXT[File Explorer]
    end
    
    CM --> FW
    FW --> FS
    FW --> RW
    FW --> IN
    FW --> PL
    FW --> VSC
    VSC --> EXT
    
    style FS fill:#e1f5fe
    style PL fill:#f3e5f5
    style FW fill:#e8f5e8
```

---

## 3. –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 3.1 CodeOSSManager Integration

File Watcher —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `CodeOSSManager` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:

```typescript
// –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const watcherConfig = {
  useFsEvents: false,    // –û—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ macOS
  usePolling: false,     // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback
  ignored: ['**/node_modules/**', '**/.git/**'],
  persistent: true,
  awaitWriteFinish: { stabilityThreshold: 100 }
}
```

### 3.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

- **add** ‚Äî –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
- **change** ‚Äî —Ñ–∞–π–ª –∏–∑–º–µ–Ω–µ–Ω
- **unlink** ‚Äî —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω
- **error** ‚Äî –æ—à–∏–±–∫–∞ watcher (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º)

---

## 4. –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 4.1 –û—à–∏–±–∫–∞ fsevents SinceNow (FSEVENTS:SINCENOW_ERROR_FIX)

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `Cannot read properties of undefined (reading 'SinceNow')` –Ω–∞ macOS.

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª—é—á–µ–Ω–∏–µ fsevents —á–µ—Ä–µ–∑ `useFsEvents: false` —Å fallback –Ω–∞ polling.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.

### 4.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (`node_modules`, `.git`)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ polling
- Debouncing –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

---

## 5. –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ú–µ—Ö–∞–Ω–∏–∑–º | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-----------|----------|-------------|
| **macOS** | fsevents ‚Üí polling | –û—Ç–∫–ª—é—á–µ–Ω fsevents –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ SinceNow |
| **Windows** | ReadDirectoryChanges | –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ |
| **Linux** | inotify | –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ |

---

## 6. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 6.1 –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ü–æ–¥—Ö–æ–¥ |
|----------|--------|
| –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –ø–∞–ø–æ–∫ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | Graceful fallback –Ω–∞ polling |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è |

### 6.2 Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| SinceNow –æ—à–∏–±–∫–∞ | `useFsEvents: false` |
| –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU | –î–æ–±–∞–≤–∏—Ç—å –≤ `ignored` —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–∞–ø–∫–∏ |
| –ü—Ä–æ–ø—É—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `awaitWriteFinish` |
| Docker | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `usePolling: true` |

---

## 7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VS Code

File Watcher —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å VS Code:

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ñ–∞–π–ª–æ–≤–æ–≥–æ –¥–µ—Ä–µ–≤–∞
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö  
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## 8. –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [File Watching Implementation](/03-core-concepts/2-shell-core/09-file-watching-implementation) ‚Äî –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

- [CodeOSS Integration](/04-reference/03-code-editor) ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VS Code
- [Manager Architecture](/03-core-concepts/1-architecture-patterns/04-manager-architecture) ‚Äî –†–æ–ª—å CodeOSSManager

---

**Revision History**

| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|--------|-----------|
| 2025-07-01 | 2.0 | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏ |
| 2025-08-05 | 1.0 | –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ |
